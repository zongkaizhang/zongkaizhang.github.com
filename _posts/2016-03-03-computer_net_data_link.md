---
layout: post
title: "计算机网络之数据链路层"
subtitle: "计算机工程的公路"
category: "计算机"
tags: [网络,TCP/IP]
---
{% include JB/setup %}
---
* content
{:toc}

# 概述 #
---

数据链路层（Data Link Layer）是OSI参考模型第二层，位于物理层与网络层之间。

# 功能 #
---

- 在两个网络实体之间提供数据链路连接的创建、维持和释放管理。构成数据链路数据单元（frame：数据帧或帧），并对帧定界、同步、收发顺序的控制。传输过程中的流量控制,差错检测和差错控制等方面。 只提供导线的一端到另一端的数据传输。

- 数据链路层会在 frame 尾端置放检查码（parity，sum，CRC）以检查实质内容，将物理层提供的可能出错的物理连接改造成逻辑上无差错的数据链路，并对物理层的原始数据进行数据封装。

- 数据链路层中的数据封装是指：封装的数据信息中，包含了地址段和数据段等。地址段含有点对点发送节点和接收节点的地址（如MAC），控制段用来表示数格连接帧的类型，数据段包含实际要传输的数据。

# 协议 #
---

## ATM ##

异步传输模式(Asynchronous Transfer Mode)，又叫信元中继。ATM采用电路交换的方式，它以信元（cell）为单位。每个信元长53字节。其中报头占了5字节。

ATM能够比较理想地实现各种QoS，既能够支持有连接的业务，又能支持无连接的业务。是宽带ISDN（B-ISDN）技术的典范。ATM为一种交换技术，在发送数据时，先将数字数据切割成多个固定长度的数据包，之后利用光纤或DS1/ DS3发送。到达目的地后，再重新组合。ATM网络可同时将声音、视频及数据集成在一起。针对各种信息型态，提供最佳的传输环境。

## IEEE 802.2 ##

[http://standards.ieee.org/about/get/802/802.2.html](http://standards.ieee.org/about/get/802/802.2.html)

- IEEE 802.1：高层局域网协议（Bridging (networking) and Network Management）
- IEEE 802.2：逻辑链路控制（Logical link control）
- IEEE 802.3：以太网（Ethernet）
- IEEE 802.4：令牌总线（Token bus）
- IEEE 802.5：令牌环（Token-Ring）
- IEEE 802.6：城域网（MAN, Metropolitan Area Network）
- IEEE 802.7：宽带TAG（Broadband LAN using Coaxial Cable）
- IEEE 802.8：光纤分布式数据接口（FDDI）
- IEEE 802.9：综合业务局域网（Integrated Services LAN）
- IEEE 802.10：局域网网络安全（Interoperable LAN Security）
- IEEE 802.11：无线局域网（Wireless LAN & Mesh）
- IEEE 802.12：需求优先级（Demand priority）
- IEEE 802.13：（未使用）
- IEEE 802.14：电缆调制解调器（Cable modems）
- IEEE 802.15：无线个人网（Wireless PAN）
	- IEEE 802.15.1：无线个人网络（WPAN, Wireless Personal Area Network）
	- IEEE 802.15.4：低速无线个人网络（LR-WPAN, Low Rate Wireless Personal Area Network）
- IEEE 802.16：宽带无线接入（Broadband Wireless Access）
- IEEE 802.17：弹性数据包环传输技术（Resilient packet ring）
- IEEE 802.18：无线电管制技术（Radio Regulatory TAG）
- IEEE 802.19：共存标签（Coexistence TAG）
- IEEE 802.20：移动宽带无线接入（Mobile Broadband Wireless Access）
- IEEE 802.21：媒介独立换手（Media Independent Handover）
- IEEE 802.22：无线区域网（Wireless Regional Area Network）
- IEEE 802.23：紧急服务工作组（Emergency Services Working Group），2010年3月新发布

### LLC ###

逻辑链路控制(Logical Link Control)

### MAC ###

介质访问控制(Media Access Control)

是局域网中数据链路层的下层部分，提供定址及媒体访问的控制方式，使得不同设备或网络上的节点可以在多点的网络上通讯，而不会互相冲突，上述的特性在局域网或者城域网中格外重要。早期网络发展时以MAC判别个网络接口之位置，但后来互联网发展后，才有IP之制定与使用[来源请求]。若只是两台设备之间全双工的通讯，因为两台设备可以同时发送及接收数据，不会冲突，因此不需要用到MAC协议。

MAC子层作为逻辑链路控制子层及物理层之间沟通的媒介，提供了一种定址的方法，称为实体地址或MAC地址。MAC地址是唯一的，每张网卡的MAC地址都不一样，因此可以在一子网中发送数据包到特定的目的设备。此处的子网是指没有路由器的实体网络（例如以太网）。

MAC常用作多路访问（multiple access）协议的同义词。因为MAC提供配合特定通道访问（channel access method）需要的协议及控制机制。因此连接在同一传输媒体的几个设备可以共享其媒体。 这种的例子包括总线网、环状网、HUB网络、无线网络及半双工的链接。

### 帧中继 ###

帧中继（frame relay）是于1992年兴起的一种新的公用数据网通讯协议，1994年开始获得迅速发展。帧中继是一种有效的数据传输技术，它可以在一对一或者一对多的应用中快速而低廉的传输数位信息。它可以使用于语音、数据通信，既可用于局域网（LAN）也可用于广域网（WAN）的通信。每个帧中继用户将得到一个接到帧中继节点的专线。帧中继网络对于端用户来说，它通过一条经常改变且对用户不可见的通道来处理和其他用户间的数据传输。

主要特点：用户信息以帧（frame）为单位进行传送，网络在传送过程中对帧结构、传送差错等情况进行检查，对出错帧直接予以丢弃，同时，通过对帧中地址段DLCI的识别，实现用户信息的统计复用。

帧中继是一种数据包交换通信网络，一般用在开放系统互连参考模型（Open System Interconnection）中的数据链路层（Data Link Layer）。永久虚拟电路PVC是用在物理网络交换式虚拟电路（SVCs）上构成端到端逻辑链接的，类似于在公共电话交换网中的电路交换，也是帧中继描述中的一部分，只是现在已经很少在实际中使用。另外，帧中继最初是为紧凑格式版的X.25协议而设计的。

数据链路连接标识符DLCI是用来标识各端点的一个具有局部意义的数值。多个PVC可以连接到同一个物理终端，PVC一般都指定承诺信息速率CIR和额外信息率EIR。

帧中继被设计为可以更有效的利用现有的物理资源，由于绝大多数的客户不可能百分之百的利用数据服务，因此允许可以给电信营运商的客户提供超过供应的数据服务。正由于电信营运商过多的预定了带宽，所以导致了帧中继在某些市场中获得了坏的名声。

电信公司一直在对外出售帧中继服务给那些在寻找比专线更低廉的客户，根据政府和电信公司的政策，它被用于各种不同的应用领域。

帧中继正逐渐被ATM、IP等协议（包括IP虚拟专用网）替代。

### HDLC ###

高级数据链路控制(High-Level Data Link Control)，是一个在同步网上传输数据、面向比特的数据链路层协议，它是由国际标准化组织制订的。

国际电信联盟已把HDLC规程引入到X.25协议栈。HDLC是修改自IBM的SDLC，后者作为数据链路层协议用于IBM自己开发的系统网络架构（SNA）。现在HDLC作为同步点对点协议（PPP）的基础已经被用于很多服务中来接入广域网，通常最常见的是因特网。

HDLC的帧格式规定以01111110（十六进制7E）的位组合作为它的起始和结束的标志，这种位组合也被称为帧界定符。

在HDLC的帧格式中，在起始标志后的是地址字段和控制字段，然后是长度在0到5000八位位组（octet）的数据字段和帧检验序列字段（FSC），最后是作为结束标志的帧界定符。一点需要指出的是，当暂时没有信息传送时，帧界定符被连续地发送直到下一次数据发送为止，产生如下图的连续比特流：

{% highlight c++ %}
0111110011111100111111001111110
 _____  ______  ______  ______ 
_     __      __      __      _
{% endhighlight %}

这种方法被用于调制解调器，通过锁相环（phase-locked loop）来训练时钟同步。

# 设备 #
---

## 桥接器 ##

又称网桥，一种网络设备，负责网络桥接（network bridging）之用。根据MAC分区块，可隔离碰撞。桥接器将网络的多个网段在数据链路层（OSI模型第2层）连接起来（即桥接）。桥接器在功能上与集线器等其他用于连接网段的设备类似，不过后者工作在物理层（OSI模型第1层）。桥接器仅仅在不同网络之间有数据传输的时候才将数据转发到其他网络，不是像集线器那样对所有数据都进行广播。对于以太网，“桥接”这一术语正式的含义是指符合IEEE 802.1D标准的设备，即“网络切换”。

若有通讯频繁的机器，则应置于同区之内，否则性能将降低。

桥接器可以分区网段，不似集线器仍是在为同一碰撞域，所以对带宽耗损较大。因桥接器通过其内之MAC表格，让发送帧不会通过，所以其称之为数据链接层操作之网络组件。

## 交换机 ##

二层交换机工作于OSI参考模型的第二层，即数据链路层。交换机内部的CPU会在每个端口成功连接时，通过将MAC地址和端口对应，形成一张MAC表。在今后的通讯中，发往该MAC地址的数据包将仅送往其对应的端口，而不是所有的端口。因此，交换机可用于划分数据链路层广播，即冲突域；但它不能划分网络层广播，即广播域。

具体可分为：

- 直通转发（cut-through）：

数据包的前6个字节（MAC地址）一到达交换机，即确定目的地址，向相应端口转发该数据包。这时可能该数据包在接收端口还没有传输完。适用于网络质量好，误码率低的情形。

- 存储转发（store-and-forward）：

交换机把收到的完整数据包暂存，然后检查其校验和或其他；通过检验的数据包再读取其目的地址，向相应端口转发。
无帧（fragment-free）：基本类似于直通转发。但对数据包的前64个字节做存储-校验-转发。因为大部分误码、碰撞（collision）发生在数据包头64字节。
通常，交换机采取直通转发，如果误码率上升到某个阈值，再改用存储转发。

当一台交换机安装配置好之后，其工作过程如下：

1. 收到某网段（设为A）MAC地址为X的计算机发给MAC地址为Y的计算机的数据包。交换机从而记下了MAC地址X在网段A。这称为学习（learning）。
2. 交换机还不知道MAC地址Y在哪个网段上，于是向除了A以外的所有网段转发该数据包。这称为洪水（flooding）。
3. MAC地址Y的计算机收到该数据包，向MAC地址X发出确认包。交换机收到该包后，从而记录下MAC地址Y所在的网段。
4. 交换机向MAC地址X转发确认包。这称为转发（forwarding）。
5. 交换机收到一个数据包，查表后发现该数据包的源地址与目的地址属于同一网段。交换机将不处理该数据包。这称为过滤（filtering）。
6. 交换机内部的MAC地址-网段查询表的每条记录采用时间戳记录最后一次访问的时间。早于某个阈值（用户可配置）的记录被清除。这称为老化（aging）。

对于全交换（full-switch）局域网，交换机每个端口只连接一台设备。因此不会发生碰撞。交换机也不需要做过滤了。

