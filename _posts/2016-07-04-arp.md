---
layout: post
title: "ARP_RARP"
subtitle: "地址解析"
category: "计算机"
tags: [TCP/IP,Linux]
---
{% include JB/setup %}
---
* content
{:toc}

# 概述 #
---

## 引言 ##

互联网是由许多物理网络和一些如路由器和网关的国际互联设备所组成,从源主机发出的分组在到达目的主机之前可能要经过许多不同的物理网络.

## 逻辑地址 ##

在网络级上主机和路由器用它们的逻辑来标识,逻辑地址就是一个互联网上的地址,它的管辖范围是全局的.逻辑地址在全局上是唯一的,
之所以叫做逻辑地址是因为逻辑地址是用软件实现的,每一个与互联网络打交道的协议都需要逻辑地址,在TCP/IP协议族中逻辑地址也叫做IP地址,它的长度是32位.

## 物理地址 ##

但是分组都要通过物理网络才能到达这些主机和路由器.在物理级上主机和路由器用它们的物理地址来标识,物理地址就是本地地址,它的管辖范围是本地网络.
物理地址在本地范围必须是唯一的,但在全局上并不是如此.之所以叫做物理地址是因为物理地址通常并非永远是用硬件实现的.
物理地址的例子就是以太网和令牌环中的48位的MAC地址.它被写入在主机或路由器中的网卡上.

物理地址和逻辑地址是两种不同的标识符,这个我们都需要,
因为一个物理网络(如以太网)可以在同一时间在网络层使用两个不同的协议(如IP和IPXNovell)同样的在网络层的分组(如IP)也可以通过不同的物理网络,
如以太网和LocalTalk.

这就表示将分组交付到一个主机或路由器都需要两级地址:逻辑地址和物理地址.
我们需要能够将一个逻辑地址映射成为它相应的物理地址,反过来的映也是需要的,这可以使用静态和动态映射.

## 静态映射 ##

静态映射是创建一个表,它将一个逻辑地址与物理地址关联起来,这个表就存储在网络上的每一个机器上.

例如,每一个机器知道其他机器的IP地址但却不知道其物理地址,可通过查表得知该物理地址.
这样做有某些局限性:因为物理地址可能会因以下原因而发生变化,一个机器可能会更换其网卡结果得到了一个新的物理地址.
在某些局域网中,如LocalTalk,每当计算机加电时,其物理地址都要改变一,移动的计算机可以从一个物理网络转移到另一个物理网络,
这就引起物理地址的改变,要完成这些变化,静态映射表必须周期性改变,这给网络增加了非常大的开销.

## 动态映射 ##

在动态映射中,每当一个机器知道两个地址,逻辑地址或物理地址中的一个时,就可以使用协议将另一个地址找出来.

已设计出两个协议来完成动态映射——地址解析协议(ARP)和逆地址解析协议(RARP).
第一个协议将逻辑地址映射为物理地址,而第二个协议将物理地址映射为逻辑地址,

<a>
	<img src="{{site.baseurl}}/img/net/arp_rarp.png">
</a>

上图表示了这一思想ARP和RARP使用单播和广播物理地址,例如在以太网全1地址作为广播地址.

## 分组格式 ##

<a>
	<img src="{{site.baseurl}}/img/net/arp_a.png">
</a>

# ARP #
---

## ARP代理 ##

如果ARP请求是从一个网络的主机发往另一个网络上的主机,那么连接这两个网络的路由器就可以回答该请求,这个过程称作ARP代理(ProxyARP).这样可以欺骗发起
ARP请求的发送端,使它误以为路由器就是目的主机,而事实上目的主机是在路由器的"另一边".路由器的功能相当于目的主机的代理,把分组从其他主机转发给它.

ARP代理也称作混合ARP(promiscuousARP)或ARP出租(ARPhack).这些名字来自于ARP代理的其他用途:通过两个物理网络之间的路由器可以互相隐藏物理网络.
在这种情况下,两个物理网络可以使用相同的网络号,只要把中间的路由器设置成一个ARP代理,以响应一个网络到另一个网络主机的ARP请求
这种技术在过去用来隐藏一组在不同物理电缆上运行旧版TCP/IP的主机.分开这些旧主机有两个共同的理由,其一是它们不能处理子网划分,
其二是它们使用旧的广播地址(所有比特值为0的主机号,而不是目前使用的所有比特值为1的主机号)

## 免费ARP ##

我们可以看到的另一个ARP特性称作免费ARP(gratuitousARP).它是指主机发送ARP查找自己的IP地址.通常,它发生在系统引导期间进行接口配置的时候.

免费ARP作用:

- 一个主机可以通过它来确定另一个主机是否设置了相同的IP地址.主机bsdi并不希望对此请求有一个回答.但是,如果收到一个回答,那么就会在终端日志上产生一个错误消息"以太网地址:a:b:c:d:e:f发送来重复的IP地址".这样就可以警告系统管理员,某个系统有不正确的设置.

- 如果发送免费ARP的主机正好改变了硬件地址(很可能是主机关机了,并换了一块接口卡,然后重新启动),那么这个分组就可以使其他主机高速缓存中旧的硬件地址进行相应的
更新.一个比较著名的ARP协议事实是,如果主机收到某个IP地址的ARP请求,而且它已经在接收者的高速缓存中,那么就要用ARP请求中的发送端硬件地址(如以太网地
址)对高速缓存中相应的内容进行更新.主机接收到任何ARP请求都要完成这个操作(ARP请求是在网上广播的,因此每次发送ARP请求时网络上的所有主机都要这样做)

## ARP命令 ##

- windows:arp-a
- linux:arp


# RARP #
---

RARP协议是许多无盘系统在引导时用来获取IP地址的.RARP分组格式基本上与ARP分组一致.一个RARP请求在网络上进行广播,它在分组中标明发送端的硬件地址,以请求相应IP地址的响应.应答通常是单播传送的.

